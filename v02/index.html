
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.2">
    
    
      
        <title>Testes de unidade da classe PdfAnnotationImporter - JabRef - Teste</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1118c9be.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ba0d045b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#testes-de-unidade-da-classe-pdfannotationimporter" class="md-skip">
          Ir para o conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="JabRef - Teste" class="md-header__button md-logo" aria-label="JabRef - Teste" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            JabRef - Teste
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Testes de unidade da classe PdfAnnotationImporter
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://antoonioaldisio.github.io/jabref/" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Antoonioaldisio
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="JabRef - Teste" class="md-nav__button md-logo" aria-label="JabRef - Teste" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    JabRef - Teste
  </label>
  
    <div class="md-nav__source">
      
<a href="https://antoonioaldisio.github.io/jabref/" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Antoonioaldisio
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Sobre
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../conf/" class="md-nav__link">
        Configuraçōes
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        Testes Unidade
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Testes Unidade" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Testes Unidade
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../v01/" class="md-nav__link">
        Teste de unidade do JabRef
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Testes de unidade da classe PdfAnnotationImporter
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Testes de unidade da classe PdfAnnotationImporter
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introducao" class="md-nav__link">
    1. Introdução
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-tabelas-das-decisoescondicoes" class="md-nav__link">
    2. Tabelas das decisões/condições
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-codigo" class="md-nav__link">
    3. Código
  </a>
  
    <nav class="md-nav" aria-label="3. Código">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-codigo-de-producao" class="md-nav__link">
    3.1 Código de Produção
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-codigo-de-teste" class="md-nav__link">
    3.2 Código de Teste
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-resultados" class="md-nav__link">
    4. Resultados
  </a>
  
    <nav class="md-nav" aria-label="4. Resultados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-resultados-dos-testes-jabref" class="md-nav__link">
    4.1 Resultados dos Testes JabRef
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-resultados-dos-meus-testes" class="md-nav__link">
    4.2 Resultados dos meus Testes
  </a>
  
    <nav class="md-nav" aria-label="4.2 Resultados dos meus Testes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-resultado-do-teste-id-01" class="md-nav__link">
    4.2.1 Resultado do teste ID 01
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422-resultado-do-teste-id-11" class="md-nav__link">
    4.2.2 Resultado do teste ID 11
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#versionamento" class="md-nav__link">
    Versionamento
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introducao" class="md-nav__link">
    1. Introdução
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-tabelas-das-decisoescondicoes" class="md-nav__link">
    2. Tabelas das decisões/condições
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-codigo" class="md-nav__link">
    3. Código
  </a>
  
    <nav class="md-nav" aria-label="3. Código">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-codigo-de-producao" class="md-nav__link">
    3.1 Código de Produção
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-codigo-de-teste" class="md-nav__link">
    3.2 Código de Teste
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-resultados" class="md-nav__link">
    4. Resultados
  </a>
  
    <nav class="md-nav" aria-label="4. Resultados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-resultados-dos-testes-jabref" class="md-nav__link">
    4.1 Resultados dos Testes JabRef
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-resultados-dos-meus-testes" class="md-nav__link">
    4.2 Resultados dos meus Testes
  </a>
  
    <nav class="md-nav" aria-label="4.2 Resultados dos meus Testes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-resultado-do-teste-id-01" class="md-nav__link">
    4.2.1 Resultado do teste ID 01
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422-resultado-do-teste-id-11" class="md-nav__link">
    4.2.2 Resultado do teste ID 11
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#versionamento" class="md-nav__link">
    Versionamento
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="testes-de-unidade-da-classe-pdfannotationimporter">Testes de unidade da classe PdfAnnotationImporter</h1>
<h2 id="1-introducao">1. Introdução</h2>
<p align = "justify">
O diretorio para encontrar a classe é o seguinte:
</p>
<pre><code>/src/main/java/org/jabref/logic/pdf/
</code></pre>
<p align = "justify">
Essa classe tem com objetivo de importar as  anotaçōes dentro do PDF.
</p>

<h2 id="2-tabelas-das-decisoescondicoes">2. Tabelas das decisões/condições</h2>
<p><center></p>
<table>
<thead>
<tr>
<th align="center">ID</th>
<th align="center">Condição</th>
<th align="center">Situação para True</th>
<th align="center">Situação para False</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">01</td>
<td align="center">!validatePath(path)</td>
<td align="center">Ter um path válido</td>
<td align="center">Não ter um path válido</td>
</tr>
<tr>
<td align="center">02</td>
<td align="center">!isSupportedAnnotationType(annotation)</td>
<td align="center">não ter uma anotação válida</td>
<td align="center">Ter uma anotação válida</td>
</tr>
<tr>
<td align="center">03</td>
<td align="center">FileAnnotationType.isMarkedFileAnnotationType(annotation.getSubtype())</td>
<td align="center">Existir uma anotação</td>
<td align="center">Não existir uma anotação</td>
</tr>
<tr>
<td align="center">04</td>
<td align="center">(fileAnnotation.getContent() != null) &amp;&amp; !fileAnnotation.getContent().isEmpty()</td>
<td align="center">Tem uma anotação e ela está vazia</td>
<td align="center">Não tem uma anotação e ela não está vazia</td>
</tr>
<tr>
<td align="center">05</td>
<td align="center">annotation.getSubtype() == null</td>
<td align="center">Ter uma anotação vazia</td>
<td align="center">Ter uma anotação prenchida</td>
</tr>
<tr>
<td align="center">06</td>
<td align="center">"Link".equals(annotation.getSubtype())</td>
<td align="center"></td>
<td align="center">"Widget".equals(annotation.getSubtype())</td>
</tr>
<tr>
<td align="center">07</td>
<td align="center">!Arrays.asList(FileAnnotationType.values()).contains(FileAnnotationType.valueOf(annotation.getSubtype()))</td>
<td align="center">Não ter a lista de anotação vazia</td>
<td align="center">Ter a lista de anotação vazia</td>
</tr>
<tr>
<td align="center">08</td>
<td align="center">annotationBelongingToMarking.getAnnotationType().isLinkedFileAnnotationType()</td>
<td align="center">Criar uma marca na anotação</td>
<td align="center">Não criar uma marca na anotação</td>
</tr>
<tr>
<td align="center">09</td>
<td align="center">!path.toString().toLowerCase(Locale.ROOT).endsWith(".pdf")</td>
<td align="center">Arquivo em formato PDF</td>
<td align="center">Não em outro formatos</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">!Files.exists(path)</td>
<td align="center">Não existir arquivo</td>
<td align="center">Existe o arquivo</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">!Files.isRegularFile(path)</td>
<td align="center"></td>
<td align="center">!Files.isReadable(path)</td>
</tr>
</tbody>
</table>
<p></center></p>
<h2 id="3-codigo">3. Código</h2>
<h3 id="31-codigo-de-producao">3.1 Código de Produção</h3>
<pre><code>public class PdfAnnotationImporter implements AnnotationImporter {

    private static final Logger LOGGER = LoggerFactory.getLogger(PdfAnnotationImporter.class);

    /**
    * Imports the comments from a pdf specified by its path
    *
    * @param path a path to a pdf
    * @return a list with the all the annotations found in the file of the path
    */
    @Override
    public List&lt;FileAnnotation&gt; importAnnotations(final Path path) {

        if (!validatePath(path)) {
            // Path could not be validated, return default result
            return Collections.emptyList();
        }

        List&lt;FileAnnotation&gt; annotationsList = new LinkedList&lt;&gt;();
        try (PDDocument document = PDDocument.load(path.toFile())) {
            PDPageTree pdfPages = document.getDocumentCatalog().getPages();
            for (int pageIndex = 0; pageIndex &lt; pdfPages.getCount(); pageIndex++) {
                PDPage page = pdfPages.get(pageIndex);
                for (PDAnnotation annotation : page.getAnnotations()) {
                    if (!isSupportedAnnotationType(annotation)) {
                        continue;
                    }

                    if (FileAnnotationType.isMarkedFileAnnotationType(annotation.getSubtype())) {
                        annotationsList.add(createMarkedAnnotations(pageIndex, page, annotation));
                    } else {
                        FileAnnotation fileAnnotation = new FileAnnotation(annotation, pageIndex + 1);
                        if ((fileAnnotation.getContent() != null) &amp;&amp; !fileAnnotation.getContent().isEmpty()) {
                            annotationsList.add(fileAnnotation);
                        }
                    }
                }
            }
        } catch (IOException e) {
            LOGGER.error(String.format("Failed to read file '%s'.", path), e);
        }
        return annotationsList;
    }

    private boolean isSupportedAnnotationType(PDAnnotation annotation) {
        if (annotation.getSubtype() == null) {
            return false;
        }
        if ("Link".equals(annotation.getSubtype()) || "Widget".equals(annotation.getSubtype())) {
            LOGGER.debug(annotation.getSubtype() + " is excluded from the supported file annotations");
            return false;
        }
        try {
            if (!Arrays.asList(FileAnnotationType.values()).contains(FileAnnotationType.valueOf(annotation.getSubtype()))) {
                return false;
            }
        } catch (IllegalArgumentException e) {
            LOGGER.debug(String.format("Could not parse the FileAnnotation %s into any known FileAnnotationType. It was %s!", annotation, annotation.getSubtype()));
        }
        return true;
    }

    private FileAnnotation createMarkedAnnotations(int pageIndex, PDPage page, PDAnnotation annotation) {
        FileAnnotation annotationBelongingToMarking = new FileAnnotation(
                annotation.getCOSObject().getString(COSName.T), FileAnnotation.extractModifiedTime(annotation.getModifiedDate()),
                pageIndex + 1, annotation.getContents(), FileAnnotationType.valueOf(annotation.getSubtype().toUpperCase(Locale.ROOT)), Optional.empty());

        if (annotationBelongingToMarking.getAnnotationType().isLinkedFileAnnotationType()) {
            try {
                COSArray boundingBoxes = (COSArray) annotation.getCOSObject().getDictionaryObject(COSName.getPDFName("QuadPoints"));
                annotation.setContents(new TextExtractor(page, boundingBoxes).extractMarkedText());
            } catch (IOException e) {
                annotation.setContents("JabRef: Could not extract any marked text!");
            }
        }

        // Marked text that has a sticky note on it should be linked to the sticky note
        return new FileAnnotation(annotation, pageIndex + 1, annotationBelongingToMarking);
    }

    private boolean validatePath(Path path) {
        Objects.requireNonNull(path);

        if (!path.toString().toLowerCase(Locale.ROOT).endsWith(".pdf")) {
            LOGGER.warn(String.format("File '%s' does not end with .pdf!", path));
            return false;
        }

        if (!Files.exists(path)) {
            LOGGER.warn(String.format("File '%s' does not exist!", path));
            return false;
        }

        if (!Files.isRegularFile(path) || !Files.isReadable(path)) {
            LOGGER.warn(String.format("File '%s' is not readable!", path));
            return false;
        }

        return true;
    }
}
</code></pre>
<h3 id="32-codigo-de-teste">3.2 Código de Teste</h3>
<pre><code>package org.jabref.logic.pdf;

import java.nio.file.Path;
import java.time.LocalDateTime;
import java.util.Collections;
import java.util.Optional;

import org.jabref.model.pdf.FileAnnotation;
import org.jabref.model.pdf.FileAnnotationType;

import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.assertEquals;

public class PdfAnnotationImporterTest {

    private final AnnotationImporter importer = new PdfAnnotationImporter();

    @Test
    public void invalidPath() {
        assertEquals(Collections.emptyList(), importer.importAnnotations(Path.of("/asdf/does/not/exist.pdf")));
    }

    @Test
    public void invalidDirectory() {
        assertEquals(Collections.emptyList(), importer.importAnnotations(Path.of("src/test/resources/pdfs")));
    }

    @Test
    public void invalidDocumentType() {
        assertEquals(Collections.emptyList(), importer.importAnnotations(Path.of("src/test/resources/pdfs/write-protected.docx")));
    }

    @Test
    public void noAnnotationsWriteProtected() {
        assertEquals(Collections.emptyList(), importer.importAnnotations(Path.of("src/test/resources/pdfs/write-protected.pdf")));
    }

    @Test
    public void noAnnotationsEncrypted() {
        assertEquals(Collections.emptyList(), importer.importAnnotations(Path.of("src/test/resources/pdfs/encrypted.pdf")));
    }

    @Test
    public void twoAnnotationsThesisExample() {
        assertEquals(2, importer.importAnnotations(Path.of("src/test/resources/pdfs/thesis-example.pdf")).size());
    }

    @Test
    public void noAnnotationsMinimal() {
        assertEquals(Collections.emptyList(), importer.importAnnotations(Path.of("src/test/resources/pdfs/minimal.pdf")));
    }

    @Test
    public void inlineNoteMinimal() {
        final FileAnnotation expected = new FileAnnotation("Linus Dietz", LocalDateTime.of(2017, 3, 12, 20, 25), 1,
                "inline note annotation", FileAnnotationType.FREETEXT, Optional.empty());

        assertEquals(Collections.singletonList(expected),
                importer.importAnnotations(Path.of("src/test/resources/pdfs/minimal-inlinenote.pdf")));
    }

    @Test
    public void popupNoteMinimal() {
        final FileAnnotation expected = new FileAnnotation("Linus Dietz", LocalDateTime.of(2017, 3, 12, 20, 17, 24), 1,
                "A simple pop-up note", FileAnnotationType.TEXT, Optional.empty());

        assertEquals(Collections.singletonList(expected),
                importer.importAnnotations(Path.of("src/test/resources/pdfs/minimal-popup.pdf")));
    }

    @Test
    public void highlightMinimalFoxit() {
        final FileAnnotation expectedLinkedAnnotation = new FileAnnotation("lynyus", LocalDateTime.of(2017, 5, 31, 15, 16, 1), 1,
                "this is a foxit highlight", FileAnnotationType.HIGHLIGHT, Optional.empty());
        final FileAnnotation expected = new FileAnnotation("lynyus", LocalDateTime.of(2017, 5, 31, 15, 16, 1), 1,
                "Hello", FileAnnotationType.HIGHLIGHT, Optional.of(expectedLinkedAnnotation));
        assertEquals(Collections.singletonList(expected),
                importer.importAnnotations(Path.of("src/test/resources/pdfs/minimal-foxithighlight.pdf")));
    }

    @Test
    public void highlightNoNoteMinimal() {
        final FileAnnotation expectedLinkedAnnotation = new FileAnnotation("Linus Dietz", LocalDateTime.of(2017, 3, 12, 20, 28, 39), 1,
                "", FileAnnotationType.HIGHLIGHT, Optional.empty());
        final FileAnnotation expected = new FileAnnotation("Linus Dietz", LocalDateTime.of(2017, 3, 12, 20, 28, 39), 1,
                "World", FileAnnotationType.HIGHLIGHT, Optional.of(expectedLinkedAnnotation));

        assertEquals(Collections.singletonList(expected),
                importer.importAnnotations(Path.of("src/test/resources/pdfs/minimal-highlight-no-note.pdf")));
    }

    @Test
    public void squigglyWithNoteMinimal() {
        final FileAnnotation expectedLinkedAnnotation = new FileAnnotation("lynyus", LocalDateTime.of(2017, 6, 1, 2, 40, 25), 1,
                "Squiggly note", FileAnnotationType.SQUIGGLY, Optional.empty());
        final FileAnnotation expected = new FileAnnotation("lynyus", LocalDateTime.of(2017, 6, 1, 2, 40, 25), 1,
                "ello", FileAnnotationType.SQUIGGLY, Optional.of(expectedLinkedAnnotation));

        assertEquals(Collections.singletonList(expected),
                importer.importAnnotations(Path.of("src/test/resources/pdfs/minimal-squiggly.pdf")));
    }

    @Test
    public void strikeoutWithNoteMinimal() {
        final FileAnnotation expectedLinkedAnnotation = new FileAnnotation("lynyus", LocalDateTime.of(2017, 6, 1, 13, 2, 3), 1,
                "striked out", FileAnnotationType.STRIKEOUT, Optional.empty());
        final FileAnnotation expected = new FileAnnotation("lynyus", LocalDateTime.of(2017, 6, 1, 13, 2, 3), 1,
                "World", FileAnnotationType.STRIKEOUT, Optional.of(expectedLinkedAnnotation));

        assertEquals(Collections.singletonList(expected),
                importer.importAnnotations(Path.of("src/test/resources/pdfs/minimal-strikeout.pdf")));
    }

    @Test
    public void highlightWithNoteMinimal() {
        final FileAnnotation expectedLinkedAnnotation = new FileAnnotation("Linus Dietz", LocalDateTime.of(2017, 3, 12, 20, 32, 2), 1,
                "linked note to highlight", FileAnnotationType.HIGHLIGHT, Optional.empty());
        final FileAnnotation expected = new FileAnnotation("Linus Dietz", LocalDateTime.of(2017, 3, 12, 20, 32, 2), 1,
                "World", FileAnnotationType.HIGHLIGHT, Optional.of(expectedLinkedAnnotation));

        assertEquals(Collections.singletonList(expected),
                importer.importAnnotations(Path.of("src/test/resources/pdfs/minimal-highlight-with-note.pdf")));
    }

    @Test
    public void underlineWithNoteMinimal() {
        final FileAnnotation expectedLinkedAnnotation = new FileAnnotation("Linus Dietz", LocalDateTime.of(2017, 3, 12, 20, 36, 9), 1,
                "underlined", FileAnnotationType.UNDERLINE, Optional.empty());
        final FileAnnotation expected = new FileAnnotation("Linus Dietz", LocalDateTime.of(2017, 3, 12, 20, 36, 9), 1,
                "Hello", FileAnnotationType.UNDERLINE, Optional.of(expectedLinkedAnnotation));

        assertEquals(Collections.singletonList(expected),
                importer.importAnnotations(Path.of("src/test/resources/pdfs/minimal-underline.pdf")));
    }

    @Test
    public void polygonNoNoteMinimal() {
        final FileAnnotation expected = new FileAnnotation("Linus Dietz", LocalDateTime.of(2017, 3, 16, 9, 21, 1), 1,
                "polygon annotation", FileAnnotationType.POLYGON, Optional.empty());

        assertEquals(Collections.singletonList(expected),
                importer.importAnnotations(Path.of("src/test/resources/pdfs/minimal-polygon.pdf")));
    }

    // Teste proposto por Antônio Aldisio
    // Verificar se abre arquivo TXT
    @Test
    public void invalidDocumentTypeTXT() {
        assertEquals(Collections.emptyList(), importer.importAnnotations(Path.of("src/test/resources/pdfs/teste.txt")));
    }
    // Verificar se ele consegue ler alguma Emoji
    @Test
    public void highlightMinimalFoxitEMOJ() {
        final FileAnnotation expectedLinkedAnnotation = new FileAnnotation("lynyus", LocalDateTime.of(2017, 5, 31, 15, 16, 1), 1,
                "😂, 😃, 🧘🏻‍♂️, 🌍, 🍞, 🚗, 📞, 🎉, ❤️, 🍆", FileAnnotationType.HIGHLIGHT, Optional.empty());
        final FileAnnotation expected = new FileAnnotation("lynyus", LocalDateTime.of(2017, 5, 31, 15, 16, 1), 1,
                "Hello", FileAnnotationType.HIGHLIGHT, Optional.of(expectedLinkedAnnotation));
        assertEquals(Collections.singletonList(expected),
                importer.importAnnotations(Path.of("src/test/resources/pdfs/minimal-emoji.pdf")));
    }
}
</code></pre>
<h2 id="4-resultados">4. Resultados</h2>
<h3 id="41-resultados-dos-testes-jabref">4.1 Resultados dos Testes JabRef</h3>
<p align = "justify">
Na figura 01 temos o resultado dos testes da classe PdfAnnotationImporter. Podemos observar que dois testes não passaram. O primeiro teste que não passou foi produzido pela JabRef e ele errou, pois alterei o comentário esperado. Então esse teste já era esperado em não passar. Já o segundo teste foi projetado por mim e será descuitdo logo adiante.
</p>

<p><center></p>
<p><img width="1000px" src="/images/TesteClasse.png" alt="Teste"></p>
<figcaption>Figura 01 - Resultado dos teste da classe PdfAnnotationImporter </figcaption>

<p></center></p>
<h3 id="42-resultados-dos-meus-testes">4.2 Resultados dos meus Testes</h3>
<p align = "justify">
Para essa etapa do projeto preferi executar apenas dois testes novos. Em relação aos ID 01 e 11. 
</p>

<h4 id="421-resultado-do-teste-id-01">4.2.1 Resultado do teste ID 01</h4>
<p align = "justify">
O teste do ID 01 já existia uma corbertura, porém a corbertura só verificava se não abria outros formatos. Com isso, fique curioso para ver se ele não executava outro tipo de formato então teste o formato .TXT. A partir da figura 02 podemos ver que o JabRef não consegue abrir um texto em formato .TXT o que era já esperado.
</p>

<p><center></p>
<p><img width="1000px" src="/images/TesteTXT.png" alt="Teste"></p>
<figcaption>Figura 02 - Resultado do Teste do ID 01</figcaption>

<p></center></p>
<h4 id="422-resultado-do-teste-id-11">4.2.2 Resultado do teste ID 11</h4>
<p align = "justify">
O teste do ID 11 já não existia uma corbertura. Altere um  <a href = "https://github.com/AntoonioAldisio/jabref/blob/main/src/test/resources/pdfs/minimal-emoji.pdf"> PDF  </a> com um comentário para uma série de Emoji (😂, 😃, 🧘🏻‍♂️, 🌍, 🍞, 🚗, 📞, 🎉, ❤️, 🍆). A partir da figura 03 podemos ver que o teste não passou. 
</p>
<p align = "justify">
Não entendi o motivo do teste não ter passado, pelo o motivo da condição ser um OU, sendo necessário apenas uma afirmação ser verdadeira. O arquivo consegue ser aberto então, ou seja, já tenho uma condiça6o verdadeira, o teste deveria ser passado já que Emoji não é uma linguagem não comprendida pelo JabRef.
</p>

<p><center></p>
<p><img width="1000px" src="/images/TesteEm.png" alt="Teste"></p>
<figcaption>Figura 03 - Resultado do Teste do ID 11</figcaption>

<p></center></p>
<h2 id="versionamento">Versionamento</h2>
<p><center></p>
<table>
<thead>
<tr>
<th>Versão</th>
<th>Data</th>
<th>Modificação</th>
<th>Autor</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0</td>
<td>05/10/2021</td>
<td>Criação do site</td>
<td>Antônio Aldísio</td>
</tr>
<tr>
<td>2.0</td>
<td>07/10/2021</td>
<td>Colocar os teste</td>
<td>Antônio Aldísio</td>
</tr>
</tbody>
</table>
<p></center></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../v01/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Teste de unidade do JabRef" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              Teste de unidade do JabRef
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "search.config.lang": "pt", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Buscar", "search.result.placeholder": "Digite para iniciar a busca", "search.result.none": "Nenhum resultado encontrado", "search.result.one": "1 resultado encontrado", "search.result.other": "# resultados encontrados", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.2b46852b.min.js"></script>
      
    
  </body>
</html>